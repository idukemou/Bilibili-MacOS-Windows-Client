{"ast":null,"code":"import \"antd/lib/input/style/css\";\nimport _Input from \"antd/lib/input\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/renderer/components/common/LoginPanel.jsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\nimport { useEffect, useState } from \"react\";\nimport '../../styles/login.css';\nimport Header from \"../layout/header\";\nimport store from \"../../redux/store\";\nimport electron from \"electron\";\nimport { getCountryListAction } from \"../../redux/actionCreators\";\nvar ipcRenderer = electron.ipcRenderer || false;\nvar captchaToken = {\n  gt: \"\",\n  challenge: \"\",\n  key: \"\",\n  validate: \"\",\n  seccode: \"\"\n};\n\nif (ipcRenderer) {\n  ipcRenderer.send(\"request_country_list\");\n  ipcRenderer.once(\"fetch_country_list\", function (event, data) {\n    store.dispatch(getCountryListAction(data));\n  });\n}\n/**\n * Country list panel.\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\n\n\nfunction CountryListSelect(props) {\n  _s();\n\n  var _this = this;\n\n  var _useState = useState(store.getState().countryList),\n      countryList = _useState[0],\n      setCountryList = _useState[1];\n\n  var _useState2 = useState(false),\n      display = _useState2[0],\n      setDisplay = _useState2[1];\n\n  useEffect(function () {\n    setCountryList(store.getState().countryList);\n  }, [store.getState().countryList]);\n  useEffect(function () {\n    props.show && setDisplay(true);\n  }, [props.show]);\n\n  function closePanel() {\n    props.handleShowCountryList();\n    setTimeout(function () {\n      setDisplay(false);\n    }, 600);\n  }\n\n  function selectCountry(data) {\n    props.changeCountry(data);\n    closePanel();\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    className: \"login-panel-wrapper country-selector-wrapper country-selector-\".concat(props.show ? 'show' : 'hide'),\n    style: {\n      display: display ? 'block' : 'none'\n    },\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      left: /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"iconfont icon-back login-close-btn\",\n        onClick: function onClick() {\n          return closePanel();\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 62,\n        columnNumber: 21\n      }, this),\n      center: /*#__PURE__*/_jsxDEV(\"span\", {\n        children: \"\\u9009\\u62E9\\u56FD\\u5BB6\\u5730\\u533A\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 65,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n      className: \"country-selector-content\",\n      children: countryList.map(function (countryItem) {\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"country-list-item\",\n          onClick: function onClick() {\n            return selectCountry({\n              id: countryItem.id,\n              cname: countryItem.cname,\n              country_id: countryItem.country_id\n            });\n          },\n          children: countryItem.cname\n        }, countryItem.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 25\n        }, _this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 56,\n    columnNumber: 9\n  }, this);\n}\n\n_s(CountryListSelect, \"k24dkr6EVzdHHUEI0ZsgKLI1MyA=\");\n\n_c = CountryListSelect;\n\nfunction CaptchaPanel(props) {\n  _s2();\n\n  function appendCaptchaPanel(captcha) {\n    captcha.appendTo(document.getElementById(\"captcha-panel-wrapper\"));\n    captcha.onSuccess(function () {\n      var result = captcha.getValidate();\n      console.log([result.geetest_validate, result.geetest_seccode]);\n      captchaToken.validate = result.geetest_validate;\n      captchaToken.seccode = result.geetest_seccode;\n      props.setShowCaptchaPanel(false);\n    });\n  }\n\n  function showCaptchaPanel() {\n    window.initGeetest({\n      gt: captchaToken.gt,\n      challenge: captchaToken.challenge,\n      offline: false,\n      new_captcha: true,\n      product: \"popup\",\n      width: \"340px\",\n      https: true\n    }, appendCaptchaPanel);\n  }\n\n  useEffect(function () {\n    showCaptchaPanel();\n  });\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"captcha-panel-container\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"captcha-panel-wrapper\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 121,\n    columnNumber: 9\n  }, this);\n}\n/**\n * Login main panel.\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\n\n\n_s2(CaptchaPanel, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n\n_c2 = CaptchaPanel;\nexport default function LoginPanel(props) {\n  _s3();\n\n  var data = {\n    loginMethod: {\n      smscode: \"smscode\",\n      password: \"password\",\n      unknown: \"unknown\"\n    },\n    title: {\n      smscode: \"手机号登录注册\",\n      password: \"密码登录\",\n      unknown: \"未知登录方式\"\n    }\n  }; // method: smscode | password | qrcode\n\n  var _useState3 = useState(data.loginMethod.smscode),\n      loginMethod = _useState3[0],\n      setLoginMethod = _useState3[1];\n\n  var _useState4 = useState(true),\n      show = _useState4[0],\n      setShow = _useState4[1];\n\n  var title = data.title[loginMethod];\n\n  var _useState5 = useState({\n    id: 1,\n    cname: \"中国大陆\",\n    country_id: 86\n  }),\n      country = _useState5[0],\n      setCountry = _useState5[1];\n\n  var _useState6 = useState(false),\n      showCountryList = _useState6[0],\n      setShowCountryList = _useState6[1];\n\n  var _useState7 = useState(false),\n      showCaptchaPanel = _useState7[0],\n      setShowCaptchaPanel = _useState7[1];\n\n  function closePenal() {\n    setShow(false);\n    setTimeout(function () {\n      props.display();\n    }, 600);\n  }\n\n  function changeLoginMethod() {\n    switch (loginMethod) {\n      case 'smscode':\n        setLoginMethod(data.loginMethod.password);\n        break;\n\n      case 'password':\n        setLoginMethod(data.loginMethod.smscode);\n        break;\n\n      default:\n        setLoginMethod(data.loginMethod.unknown);\n    }\n  }\n\n  function handleShowCountryList() {\n    setShowCountryList(!showCountryList);\n  }\n\n  function changeCountry(data) {\n    setCountry(data);\n  }\n\n  function displayCaptchaPanel() {\n    if (showCaptchaPanel === true) return;\n    ipcRenderer.invoke('request_captcha_token').then(function (data) {\n      captchaToken.gt = data.gt;\n      captchaToken.challenge = data.challenge;\n      captchaToken.key = data.key;\n      return true;\n    }).then(function (res) {\n      res && setShowCaptchaPanel(true);\n    });\n  }\n\n  function userLogin() {\n    console.log(\"cid: \", country.id);\n    console.log(\"country\", country.cname);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    id: \"login-panel-container\",\n    onClick: function onClick(e) {\n      e.preventDefault();\n\n      if (e.target.id === 'login-panel-container') {\n        closePenal();\n      }\n    },\n    children: /*#__PURE__*/_jsxDEV(\"section\", {\n      id: \"login-panel-container-wrapper\",\n      className: \"login-panel-\".concat(show ? 'show' : 'hide'),\n      children: [/*#__PURE__*/_jsxDEV(\"section\", {\n        className: \"login-panel-wrapper\",\n        children: [/*#__PURE__*/_jsxDEV(Header, {\n          left: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"iconfont icon-close login-close-btn\",\n            onClick: function onClick() {\n              return closePenal();\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 222,\n            columnNumber: 29\n          }, this),\n          center: /*#__PURE__*/_jsxDEV(\"span\", {\n            children: title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 225,\n            columnNumber: 29\n          }, this),\n          right: /*#__PURE__*/_jsxDEV(\"a\", {\n            href: \"#\",\n            onClick: function onClick() {\n              return changeLoginMethod();\n            },\n            children: loginMethod === 'smscode' ? data.title.password : data.title.smscode\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 228,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n          className: \"login-panel-content\",\n          children: [loginMethod === 'smscode' && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"login-panel-content-wrapper\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"login-panel-input-filed\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"login-panel-input-item country-selector\",\n                onClick: function onClick() {\n                  return handleShowCountryList();\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  children: country.cname\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 237,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"i\", {\n                  className: \"iconfont icon-next\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 238,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 236,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"login-panel-input-item phone-number\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"input-item-title\",\n                  children: [\"+\", country.country_id]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 242,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(_Input, {\n                  placeholder: \"\\u8BF7\\u8F93\\u5165\\u624B\\u673A\\u53F7\\u7801\",\n                  maxLength: 16,\n                  allowClear: true,\n                  className: \"phone-number-input\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 243,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"getCaptcha\",\n                  onClick: function onClick() {\n                    return displayCaptchaPanel();\n                  },\n                  children: \"\\u83B7\\u53D6\\u9A8C\\u8BC1\\u7801\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 244,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 241,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"login-panel-input-item\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"input-item-title\",\n                  children: \"\\u9A8C\\u8BC1\\u7801\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 250,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(_Input, {\n                  placeholder: \"\\u8BF7\\u8F93\\u5165\\u9A8C\\u8BC1\\u7801\",\n                  maxLength: 8,\n                  allowClear: true,\n                  className: \"captcha-input\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 251,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 249,\n                columnNumber: 37\n              }, this), showCaptchaPanel && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"login-panel-input-item captcha-item\",\n                children: showCaptchaPanel && /*#__PURE__*/_jsxDEV(CaptchaPanel, {\n                  setShowCaptchaPanel: setShowCaptchaPanel\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 256,\n                  columnNumber: 66\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 255,\n                columnNumber: 61\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 235,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n              href: \"#\",\n              className: \"smscode-validate-login-btn\",\n              onClick: function onClick() {\n                return userLogin();\n              },\n              children: \"\\u9A8C\\u8BC1\\u767B\\u5F55\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 261,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 234,\n            columnNumber: 58\n          }, this), loginMethod === 'password' && /*#__PURE__*/_jsxDEV(\"section\", {\n            id: \"login-panel-content-wrapper\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 272,\n            columnNumber: 59\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(CountryListSelect, {\n        show: showCountryList,\n        handleShowCountryList: handleShowCountryList,\n        changeCountry: changeCountry\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 277,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 210,\n    columnNumber: 9\n  }, this);\n}\n\n_s3(LoginPanel, \"KBsW1oSLP/usmXG0m+O8EHNK/m0=\");\n\n_c3 = LoginPanel;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"CountryListSelect\");\n$RefreshReg$(_c2, \"CaptchaPanel\");\n$RefreshReg$(_c3, \"LoginPanel\");","map":{"version":3,"sources":["/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/renderer/components/common/LoginPanel.jsx"],"names":["useEffect","useState","Header","store","electron","getCountryListAction","ipcRenderer","captchaToken","gt","challenge","key","validate","seccode","send","once","event","data","dispatch","CountryListSelect","props","getState","countryList","setCountryList","display","setDisplay","show","closePanel","handleShowCountryList","setTimeout","selectCountry","changeCountry","map","countryItem","id","cname","country_id","CaptchaPanel","appendCaptchaPanel","captcha","appendTo","document","getElementById","onSuccess","result","getValidate","console","log","geetest_validate","geetest_seccode","setShowCaptchaPanel","showCaptchaPanel","window","initGeetest","offline","new_captcha","product","width","https","LoginPanel","loginMethod","smscode","password","unknown","title","setLoginMethod","setShow","country","setCountry","showCountryList","setShowCountryList","closePenal","changeLoginMethod","displayCaptchaPanel","invoke","then","res","userLogin","e","preventDefault","target"],"mappings":"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","sourcesContent":["import {useEffect, useState} from \"react\";\nimport {Input} from 'antd';\nimport '../../styles/login.css';\nimport Header from \"../layout/header\";\nimport store from \"../../redux/store\";\nimport electron from \"electron\";\nimport {getCountryListAction} from \"../../redux/actionCreators\";\n\nconst ipcRenderer = electron.ipcRenderer || false;\nlet captchaToken = {\n    gt: \"\",\n    challenge: \"\",\n    key: \"\",\n    validate: \"\",\n    seccode: \"\"\n}\n\nif(ipcRenderer){\n    ipcRenderer.send(\"request_country_list\");\n    ipcRenderer.once(\"fetch_country_list\", (event, data) => {\n        store.dispatch(getCountryListAction(data));\n    });\n}\n\n/**\n * Country list panel.\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\nfunction CountryListSelect(props){\n    const [countryList, setCountryList] = useState(store.getState().countryList);\n    const [display, setDisplay] = useState(false);\n\n    useEffect(() => {\n        setCountryList(store.getState().countryList);\n    }, [store.getState().countryList])\n\n    useEffect(() => {\n        props.show && setDisplay(true);\n    }, [props.show]);\n\n    function closePanel(){\n        props.handleShowCountryList();\n        setTimeout(() => {\n            setDisplay(false);\n        }, 600);\n    }\n\n    function selectCountry(data){\n        props.changeCountry(data);\n        closePanel();\n    }\n\n    return (\n        <section\n            className={`login-panel-wrapper country-selector-wrapper country-selector-${props.show ? 'show' : 'hide'}`}\n            style={{display: (display? 'block': 'none')}}\n        >\n            <Header\n                left={\n                    <span className=\"iconfont icon-back login-close-btn\" onClick={() => closePanel()}/>\n                }\n                center={\n                    <span>选择国家地区</span>\n                }\n            />\n\n            <section className=\"country-selector-content\">\n                {\n                    countryList.map((countryItem) => (\n                        <div\n                            className=\"country-list-item\"\n                            key={countryItem.id}\n                            onClick={() => selectCountry({\n                                id: countryItem.id,\n                                cname: countryItem.cname,\n                                country_id: countryItem.country_id\n                            })}>\n                            {countryItem.cname}\n                        </div>\n                    ))\n                }\n            </section>\n        </section>\n    )\n}\n\n\nfunction CaptchaPanel(props){\n\n    function appendCaptchaPanel(captcha){\n        captcha.appendTo(document.getElementById(\"captcha-panel-wrapper\"));\n\n        captcha.onSuccess(() => {\n            const result = captcha.getValidate();\n            console.log([result.geetest_validate, result.geetest_seccode]);\n            captchaToken.validate = result.geetest_validate;\n            captchaToken.seccode = result.geetest_seccode;\n            props.setShowCaptchaPanel(false);\n        })\n    }\n\n    function showCaptchaPanel(){\n        window.initGeetest({\n            gt: captchaToken.gt,\n            challenge: captchaToken.challenge,\n            offline: false,\n            new_captcha: true,\n            product: \"popup\",\n            width: \"340px\",\n            https: true\n        }, appendCaptchaPanel)\n    }\n\n    useEffect(() => {\n        showCaptchaPanel();\n    })\n\n    return(\n        <div id=\"captcha-panel-container\">\n            <div id=\"captcha-panel-wrapper\"></div>\n        </div>\n    )\n}\n\n\n\n/**\n * Login main panel.\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\nexport default function LoginPanel(props){\n\n    const data = {\n        loginMethod: {\n            smscode: \"smscode\",\n            password: \"password\",\n            unknown: \"unknown\"\n        },\n        title: {\n            smscode: \"手机号登录注册\",\n            password: \"密码登录\",\n            unknown: \"未知登录方式\"\n        }\n    }\n\n    // method: smscode | password | qrcode\n    const [loginMethod, setLoginMethod] = useState(data.loginMethod.smscode);\n    const [show, setShow] = useState(true);\n    let title = data.title[loginMethod];\n    const [country, setCountry] = useState({\n        id: 1,\n        cname: \"中国大陆\",\n        country_id: 86\n    });\n    const [showCountryList, setShowCountryList] = useState(false);\n    const [showCaptchaPanel, setShowCaptchaPanel] = useState(false);\n\n    function closePenal(){\n        setShow(false);\n        setTimeout(() => {\n            props.display();\n        }, 600);\n    }\n\n    function changeLoginMethod(){\n        switch (loginMethod) {\n            case 'smscode':\n                setLoginMethod(data.loginMethod.password);\n                break;\n            case 'password':\n                setLoginMethod(data.loginMethod.smscode);\n                break;\n            default:\n                setLoginMethod(data.loginMethod.unknown);\n        }\n    }\n\n    function handleShowCountryList(){\n        setShowCountryList(!showCountryList);\n    }\n\n    function changeCountry(data){\n        setCountry(data);\n    }\n\n    function displayCaptchaPanel(){\n        if(showCaptchaPanel === true) return;\n        ipcRenderer.invoke('request_captcha_token')\n            .then((data) => {\n                captchaToken.gt = data.gt;\n                captchaToken.challenge = data.challenge;\n                captchaToken.key = data.key;\n                return true;\n            })\n            .then(res => {\n                res && setShowCaptchaPanel(true);\n            })\n    }\n\n    function userLogin(){\n        console.log(\"cid: \", country.id);\n        console.log(\"country\", country.cname);\n    }\n\n    return (\n        <section id=\"login-panel-container\"\n            onClick={(e) => {\n                e.preventDefault();\n                if(e.target.id === 'login-panel-container'){\n                    closePenal();\n                }\n            }}\n        >\n            <section id=\"login-panel-container-wrapper\" className={`login-panel-${show ? 'show' : 'hide'}`}>\n                <section className={`login-panel-wrapper`}>\n                    <Header\n                        left={\n                            <span className=\"iconfont icon-close login-close-btn\" onClick={() => closePenal()} />\n                        }\n                        center={\n                            <span>{title}</span>\n                        }\n                        right={\n                            <a href=\"#\" onClick={() => changeLoginMethod()}>{loginMethod === 'smscode' ? data.title.password : data.title.smscode}</a>\n                        }\n                    />\n\n                    <section className=\"login-panel-content\">\n                        {\n                            loginMethod === 'smscode' && <div className=\"login-panel-content-wrapper\">\n                                <div className=\"login-panel-input-filed\">\n                                    <div className=\"login-panel-input-item country-selector\" onClick={() => handleShowCountryList()}>\n                                        <span>{country.cname}</span>\n                                        <i className=\"iconfont icon-next\" />\n                                    </div>\n\n                                    <div className=\"login-panel-input-item phone-number\">\n                                        <span className=\"input-item-title\">+{country.country_id}</span>\n                                        <Input placeholder=\"请输入手机号码\" maxLength={16} allowClear={true} className=\"phone-number-input\"/>\n                                        <span className=\"getCaptcha\" onClick={() => displayCaptchaPanel()}>\n                                            获取验证码\n                                        </span>\n                                    </div>\n\n                                    <div className=\"login-panel-input-item\">\n                                        <span className=\"input-item-title\">验证码</span>\n                                        <Input placeholder=\"请输入验证码\" maxLength={8} allowClear={true} className=\"captcha-input\"/>\n                                    </div>\n\n                                    {\n                                        showCaptchaPanel && <div className=\"login-panel-input-item captcha-item\">\n                                            {showCaptchaPanel && <CaptchaPanel setShowCaptchaPanel={setShowCaptchaPanel}/>}\n                                        </div>\n                                    }\n                                </div>\n\n                                <a\n                                    href=\"#\"\n                                    className=\"smscode-validate-login-btn\"\n                                    onClick={() => userLogin()}\n                                >\n                                    验证登录\n                                </a>\n                            </div>\n                        }\n\n                        {\n                            loginMethod === 'password' && <section id=\"login-panel-content-wrapper\"></section>\n                        }\n                    </section>\n                </section>\n\n                <CountryListSelect\n                    show={showCountryList}\n                    handleShowCountryList={handleShowCountryList}\n                    changeCountry={changeCountry}\n                />\n            </section>\n        </section>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}