{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport _defineProperty from \"/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport store from \"../../redux/store\";\nimport electron from 'electron';\nimport { getRecommendListAction, playVideoInfoAction, appendRecommendListAction, platVideoStatusAction } from \"../../redux/actionCreators\";\nimport { convertDuration, convertViews } from \"../../utils/utils\";\nvar ipcRenderer = electron.ipcRenderer || false;\n\nif (ipcRenderer) {\n  ipcRenderer.send('request_recommend_list');\n  ipcRenderer.on('fetch_recommend_list', /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event, data) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.t0 = store;\n              _context.next = 3;\n              return getRecommendListAction(data);\n\n            case 3:\n              _context.t1 = _context.sent;\n\n              _context.t0.dispatch.call(_context.t0, _context.t1);\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x, _x2) {\n      return _ref.apply(this, arguments);\n    };\n  }());\n}\n/**\n * Recommend UI Component.\n * @param props the props from its parent component\n * @returns {JSX.Element} the UI parts used for rendering\n * @constructor none\n */\n\n\nfunction RecommendUI(props) {\n  var box = useRef(null);\n  var data = props.videoInfo;\n  var interval = 1;\n\n  var _useState = useState(0),\n      offsetTop = _useState[0],\n      setOffsetTop = _useState[1];\n\n  var _useState2 = useState(true),\n      display = _useState2[0],\n      setDisplay = _useState2[1];\n\n  useEffect(function () {\n    if (props.clientData.scrollTop - offsetTop * interval > 0 || offsetTop - 240 * interval - props.clientData.scrollTop > props.clientData.clientHeight) {\n      setDisplay(false);\n    } else {\n      setDisplay(true);\n    }\n  });\n  useEffect(function () {\n    setOffsetTop(box.current.offsetTop + 220);\n  }, [offsetTop]);\n\n  function playVideo(bvid) {\n    ipcRenderer.send('request_video_play_info', bvid);\n    ipcRenderer.once('fetch_video_play_info', /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event, data) {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.t0 = store;\n                _context2.next = 3;\n                return playVideoInfoAction(data);\n\n              case 3:\n                _context2.t1 = _context2.sent;\n\n                _context2.t0.dispatch.call(_context2.t0, _context2.t1);\n\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x3, _x4) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n    store.dispatch(platVideoStatusAction(true));\n    ipcRenderer.removeAllListeners('request_video_play_info');\n  }\n  /**\n   * return UI Component\n   */\n\n\n  return /*#__PURE__*/_jsx(\"div\", {\n    className: \"rcmd-item\",\n    ref: box,\n    onClick: function onClick() {\n      return playVideo(data.bvid);\n    },\n    children: /*#__PURE__*/_jsxs(\"div\", {\n      className: 'rcmd-item-wrapper',\n      style: {\n        display: display ? 'block' : 'none'\n      },\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: \"rcmd-item-info-wrapper\",\n        children: [/*#__PURE__*/_jsx(\"img\", {\n          src: data.pic,\n          alt: data.title,\n          className: \"rcmd-item-image\"\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"rcmd-item-stat\",\n          children: [/*#__PURE__*/_jsxs(\"span\", {\n            className: \"rcmd-item-duration\",\n            children: [\" \", convertDuration(data.duration), \" \"]\n          }), /*#__PURE__*/_jsxs(\"span\", {\n            className: \"rcmd-item-views\",\n            children: [\" \", convertViews(data.stat.view), \"\\u89C2\\u770B \"]\n          })]\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"rcmd-item-title-wrapper\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"rcmd-item-owner\",\n          children: /*#__PURE__*/_jsx(\"img\", {\n            src: data.owner.face,\n            alt: data.owner.name\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"rcmd-item-title\",\n          children: /*#__PURE__*/_jsxs(\"strong\", {\n            children: [\" \", data.title, \" \"]\n          })\n        })]\n      })]\n    })\n  });\n}\n/**\n * Recommend Section Component\n * @param props the props from parent component\n * @returns {JSX.Element} the Recommend UI parts used for rendering\n * @constructor none\n */\n\n\nexport default function Recommend(props) {\n  var _useState3 = useState(store.getState().recommendList),\n      recommendList = _useState3[0],\n      setRecommendList = _useState3[1];\n\n  var _useState4 = useState(false),\n      locker = _useState4[0],\n      setLocker = _useState4[1];\n  /**\n   * Effect for update value of commendList\n   */\n\n\n  useEffect(function () {\n    store.subscribe(function () {\n      setRecommendList(store.getState().recommendList);\n    });\n  }, [store.getState().recommendList]);\n  /**\n   * Effect for update value of loading\n   */\n\n  useEffect(function () {\n    if (props.loading && !locker) {\n      loadMore();\n      setLocker(false);\n    }\n  }, [props.loading]);\n  /**\n   * request more data from API\n   */\n\n  function loadMore() {\n    setLocker(true);\n\n    if (ipcRenderer) {\n      ipcRenderer.invoke('request_recommend_list_append').then(function (data) {\n        var temp = recommendList.concat(data.item); // setRecommendList(temp);\n\n        store.dispatch(appendRecommendListAction(temp));\n      });\n    }\n  }\n  /**\n   * return UI Components\n   */\n\n\n  return /*#__PURE__*/_jsx(_Fragment, {\n    children: recommendList.map(function (list, index) {\n      return /*#__PURE__*/_jsx(RecommendUI, _objectSpread({\n        videoInfo: list\n      }, props), index);\n    })\n  });\n}","map":null,"metadata":{},"sourceType":"module"}