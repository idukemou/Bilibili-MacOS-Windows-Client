{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/renderer/components/common/videoDetail.jsx\";\nimport { useEffect, useState } from \"react\";\nimport store from \"../../redux/store\";\nimport { platVideoStatusAction, playVideoInfoAction } from \"../../redux/actionCreators\";\nimport { convertDuration } from \"../../utils/utils\";\nimport '../../styles/videoPlayer.css';\n\nfunction MediaPlayer(props) {\n  const {\n    0: player,\n    1: setPlayer\n  } = useState(null);\n  const {\n    0: mediaContainer,\n    1: setMediaContainer\n  } = useState(null);\n  const {\n    0: url,\n    1: setUrl\n  } = useState(store.getState().videoInfo.url);\n  const {\n    0: ready,\n    1: setReady\n  } = useState(false);\n  const {\n    0: isPlay,\n    1: setIsPlay\n  } = useState(false);\n  const {\n    0: isMuted,\n    1: setIsMuted\n  } = useState(false);\n  const {\n    0: processTime,\n    1: setProcessTime\n  } = useState(-1);\n  let processor = null;\n  useEffect(() => {\n    let unsubscribe = store.subscribe(() => {\n      if (JSON.stringify(store.getState().videoInfo.url) !== '{}') {\n        setUrl(store.getState().videoInfo.url.durl[0].url);\n        unsubscribe();\n      }\n    });\n\n    if (flvjs.isSupported() && url.length > 10) {\n      setPlayer(flvjs.createPlayer({\n        type: 'flv',\n        isLive: false,\n        hasVideo: true,\n        hasAudio: true,\n        url: url\n      }, {\n        lazyLoad: false\n      }));\n      setMediaContainer(document.getElementById('media-player'));\n      setReady(true);\n    }\n  }, [url]);\n  useEffect(() => {\n    if (player !== null) {\n      initPlayer();\n    }\n  }, [ready]);\n\n  function initPlayer() {\n    if (player !== null && mediaContainer !== null) {\n      player.attachMediaElement(mediaContainer);\n      player.load();\n\n      mediaContainer.onloadeddata = () => {\n        play();\n      }; // mediaContainer.onplay = () => {\n      //     clearInterval(processor);\n      //     processor = setInterval(() => {\n      //         setProcessTime(convertDuration(getCurrentTime()));\n      //         console.log(\"buffer: \", mediaContainer.buffered.length);\n      //         console.log(\"end: \", mediaContainer.buffered.end(0));\n      //     }, 1000);\n      // }\n\n\n      mediaContainer.onended = () => {\n        clearInterval(processor);\n      };\n\n      mediaContainer.onstalled = () => {\n        console.log(\"stalled\");\n      };\n    }\n  }\n\n  function play() {\n    if (player !== null) {\n      player.play().then(() => {\n        setIsPlay(true);\n      }).catch(e => {});\n    }\n  }\n\n  function pause() {\n    if (player !== null) {\n      player.pause();\n      setIsPlay(false);\n    }\n  }\n\n  function destroy() {\n    if (player !== null) {\n      pause();\n      player.unload();\n      player.detachMediaElement();\n      player.destroy();\n      setPlayer(null);\n    }\n  }\n\n  function getCurrentTime() {\n    if (player !== null && convertDuration(player.currentTime) < convertDuration(player.duration)) {\n      return player.currentTime;\n    }\n\n    return -1;\n  }\n\n  function setCurrentTime(time) {\n    if (player !== null) {\n      player.currentTime = time;\n    }\n  }\n\n  function appendSeek(time) {\n    player.currentTime = player.currentTime + time;\n  }\n\n  function pushSeek() {\n    appendSeek(0.1);\n  }\n\n  function muteSwitcher() {\n    isMuted ? setIsMuted(false) : setIsMuted(true);\n  }\n\n  function playSwitcher() {\n    isPlay ? pause() : play();\n  }\n\n  function replay() {\n    if (player !== null) {\n      pause();\n      setCurrentTime(0);\n      play();\n    }\n  }\n\n  function setSpeedRate(rate) {\n    if (mediaContainer !== null) {\n      mediaContainer.playbackRate = rate;\n    }\n  }\n\n  function close() {\n    destroy();\n    props.quit();\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"media-player-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"video\", {\n        id: \"media-player\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"media-controls\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"media-control-play\",\n          onClick: () => playSwitcher(),\n          children: isPlay ? \"暂停\" : \"播放\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"media-control-speed\",\n          onClick: () => setSpeedRate(2),\n          children: \"2X\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"media-control-speed\",\n          onClick: () => setSpeedRate(1),\n          children: \"\\u539F\\u901F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"media-control-mute\",\n          onClick: () => muteSwitcher(),\n          children: \"\\u9759\\u97F3\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"media-control-replay\",\n          onClick: () => replay(),\n          children: \"\\u91CD\\u64AD\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"media-control-close\",\n          onClick: () => close(),\n          children: \"\\u5173\\u95ED\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"progress-bar-wrapper\",\n      onClick: () => console.log('touched'),\n      children: /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"range\",\n        min: \"0\",\n        max: \"100\",\n        className: \"progress-bar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true);\n}\n/**\n *\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\n\n\nexport default function VideoDetail(props) {\n  const {\n    0: status,\n    1: setStatus\n  } = useState(store.getState().playVideoStatus);\n  useEffect(() => {\n    store.subscribe(() => {\n      setStatus(store.getState().playVideoStatus);\n    });\n  }, [store.getState().playVideoStatus]);\n\n  function exitVideo() {\n    store.dispatch(platVideoStatusAction(false));\n    store.dispatch(playVideoInfoAction({\n      url: {},\n      info: {}\n    }));\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    style: {\n      position: 'absolute',\n      top: 0,\n      left: 0,\n      right: 0,\n      bottom: 0,\n      zIndex: '100',\n      width: \"100%\",\n      height: \"100%\",\n      backgroundColor: '#fff',\n      display: status ? 'block' : 'none',\n      overflow: \"scroll\"\n    },\n    children: status && /*#__PURE__*/_jsxDEV(MediaPlayer, {\n      quit: exitVideo\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 27\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 217,\n    columnNumber: 9\n  }, this);\n}","map":{"version":3,"sources":["/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/renderer/components/common/videoDetail.jsx"],"names":["useEffect","useState","store","platVideoStatusAction","playVideoInfoAction","convertDuration","MediaPlayer","props","player","setPlayer","mediaContainer","setMediaContainer","url","setUrl","getState","videoInfo","ready","setReady","isPlay","setIsPlay","isMuted","setIsMuted","processTime","setProcessTime","processor","unsubscribe","subscribe","JSON","stringify","durl","flvjs","isSupported","length","createPlayer","type","isLive","hasVideo","hasAudio","lazyLoad","document","getElementById","initPlayer","attachMediaElement","load","onloadeddata","play","onended","clearInterval","onstalled","console","log","then","catch","e","pause","destroy","unload","detachMediaElement","getCurrentTime","currentTime","duration","setCurrentTime","time","appendSeek","pushSeek","muteSwitcher","playSwitcher","replay","setSpeedRate","rate","playbackRate","close","quit","VideoDetail","status","setStatus","playVideoStatus","exitVideo","dispatch","info","position","top","left","right","bottom","zIndex","width","height","backgroundColor","display","overflow"],"mappings":"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","sourcesContent":["import {useEffect, useState} from \"react\";\nimport store from \"../../redux/store\";\nimport {platVideoStatusAction, playVideoInfoAction} from \"../../redux/actionCreators\";\nimport {convertDuration} from \"../../utils/utils\";\nimport '../../styles/videoPlayer.css';\n\nfunction MediaPlayer(props){\n    const [player, setPlayer] = useState(null);\n    const [mediaContainer, setMediaContainer] = useState(null);\n    const [url, setUrl] = useState(store.getState().videoInfo.url);\n    const [ready, setReady] = useState(false);\n\n    const [isPlay, setIsPlay] = useState(false);\n    const [isMuted, setIsMuted] = useState(false);\n\n    const [processTime, setProcessTime] = useState(-1);\n    let processor = null;\n\n\n\n\n    useEffect(() => {\n        let unsubscribe = store.subscribe(() => {\n            if(JSON.stringify(store.getState().videoInfo.url) !== '{}'){\n                setUrl(store.getState().videoInfo.url.durl[0].url);\n                unsubscribe();\n            }\n        })\n\n        if(flvjs.isSupported() && url.length > 10){\n            setPlayer(flvjs.createPlayer({\n                type: 'flv',\n                isLive: false,\n                hasVideo: true,\n                hasAudio: true,\n                url: url\n            }, {\n                lazyLoad: false,\n            }));\n            setMediaContainer(document.getElementById('media-player'));\n            setReady(true);\n        }\n    }, [url]);\n\n    useEffect(() => {\n        if(player !== null){\n            initPlayer();\n        }\n    }, [ready]);\n\n    function initPlayer(){\n        if(player !== null && mediaContainer !== null){\n            player.attachMediaElement(mediaContainer);\n            player.load();\n\n            mediaContainer.onloadeddata = () => {\n                play();\n            }\n\n            // mediaContainer.onplay = () => {\n            //     clearInterval(processor);\n            //     processor = setInterval(() => {\n            //         setProcessTime(convertDuration(getCurrentTime()));\n            //         console.log(\"buffer: \", mediaContainer.buffered.length);\n            //         console.log(\"end: \", mediaContainer.buffered.end(0));\n            //     }, 1000);\n            // }\n\n            mediaContainer.onended = () => {\n                clearInterval(processor);\n            }\n\n            mediaContainer.onstalled = () => {\n                console.log(\"stalled\");\n            }\n\n\n        }\n    }\n\n    function play(){\n        if(player !== null){\n            player.play()\n                .then(() => {\n                    setIsPlay(true);\n                })\n                .catch((e) => {});\n        }\n    }\n\n    function pause(){\n        if (player !== null){\n            player.pause();\n            setIsPlay(false);\n        }\n    }\n\n    function destroy(){\n        if(player !== null){\n            pause();\n            player.unload();\n            player.detachMediaElement();\n            player.destroy();\n            setPlayer(null);\n        }\n    }\n\n    function getCurrentTime(){\n        if((player !== null) && (convertDuration(player.currentTime) < convertDuration(player.duration))){\n            return player.currentTime;\n        }\n        return -1;\n    }\n\n    function setCurrentTime(time){\n        if(player !== null){\n            player.currentTime = time;\n        }\n    }\n\n    function appendSeek(time){\n        player.currentTime = player.currentTime + time;\n    }\n\n    function pushSeek(){\n        appendSeek(0.1);\n    }\n\n    function muteSwitcher(){\n        isMuted ? setIsMuted(false) : setIsMuted(true);\n    }\n\n    function playSwitcher(){\n        isPlay ? pause(): play();\n    }\n\n    function replay(){\n        if(player !== null){\n            pause();\n            setCurrentTime(0);\n            play();\n        }\n    }\n\n    function setSpeedRate(rate){\n        if(mediaContainer !== null){\n            mediaContainer.playbackRate = rate;\n        }\n    }\n\n    function close(){\n        destroy();\n        props.quit();\n    }\n\n\n    return(\n        <>\n            <div className=\"media-player-container\">\n                <video id='media-player'/>\n                <div className=\"media-controls\">\n                    <button className=\"media-control-play\" onClick={() => playSwitcher()}>\n                        {isPlay ? \"暂停\" : \"播放\"}\n                    </button>\n                    <button className=\"media-control-speed\" onClick={() => setSpeedRate(2)}>2X</button>\n                    <button className=\"media-control-speed\" onClick={() => setSpeedRate(1)}>原速</button>\n                    <button className=\"media-control-mute\" onClick={() => muteSwitcher()}>静音</button>\n                    <button className=\"media-control-replay\" onClick={() => replay()}>重播</button>\n                    <button className=\"media-control-close\" onClick={() => close()}>关闭</button>\n                </div>\n            </div>\n\n            {/*<button onClick={() => flvPlayer.play()}>play</button>*/}\n            {/*<button onClick={() => flvPlayer.pause()}>pause</button>*/}\n            {/*<button onClick={() => flvPlayer.destroy()}>destroy</button>*/}\n            {/*<button onClick={() => flvPlayer.setCurrentTime(10)}>加10秒</button>*/}\n            {/*<button onClick={() => flvPlayer.muteSwitch()}>静音</button>*/}\n            {/*<button onClick={() => {console.log(flvPlayer.getDuration())}}>获取播放长度</button>*/}\n            {/*<button onClick={() => flvPlayer.setPlaySpeed(2)}>2x速度</button>*/}\n            {/*<button onClick={() => flvPlayer.replayVideo()}>重新播放</button><br/><br/>*/}\n\n            <div className=\"progress-bar-wrapper\" onClick={() => console.log('touched')}>\n                <input type=\"range\" min=\"0\" max=\"100\" className=\"progress-bar\"/>\n            </div>\n\n        </>\n    )\n}\n\n\n/**\n *\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\nexport default function VideoDetail(props){\n\n    const [status, setStatus] = useState(store.getState().playVideoStatus);\n\n    useEffect(() => {\n        store.subscribe(() => {\n            setStatus(store.getState().playVideoStatus);\n        })\n    }, [store.getState().playVideoStatus]);\n\n\n    function exitVideo(){\n        store.dispatch(platVideoStatusAction(false));\n        store.dispatch(playVideoInfoAction({\n            url: {},\n            info: {}\n        }));\n    }\n\n    return(\n        <section style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            right: 0,\n            bottom: 0,\n            zIndex: '100',\n            width: \"100%\",\n            height: \"100%\",\n            backgroundColor: '#fff',\n            display: (status ? 'block': 'none'),\n            overflow: \"scroll\"\n        }}>\n            {\n                status && <MediaPlayer quit={exitVideo} />\n            }\n        </section>\n    )\n}"]},"metadata":{},"sourceType":"module"}