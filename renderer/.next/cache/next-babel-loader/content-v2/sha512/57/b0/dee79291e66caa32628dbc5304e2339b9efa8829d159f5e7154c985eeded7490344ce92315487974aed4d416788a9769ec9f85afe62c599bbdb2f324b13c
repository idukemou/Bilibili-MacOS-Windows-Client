{"ast":null,"code":"import _assertThisInitialized from \"/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/node_modules/next/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _defineProperty from \"/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _classCallCheck from \"/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/node_modules/next/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/node_modules/next/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/node_modules/next/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/node_modules/next/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/node_modules/next/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _regeneratorRuntime from \"/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport store from \"../../redux/store\";\nimport electron from 'electron';\nimport { getRecommendListAction } from \"../../redux/actionCreators\";\nvar ipcRenderer = electron.ipcRenderer || false;\n\nif (ipcRenderer) {\n  ipcRenderer.send('request_recommend_list');\n  ipcRenderer.on('fetch_recommend_list', /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event, data) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.t0 = store;\n              _context.next = 3;\n              return getRecommendListAction(data);\n\n            case 3:\n              _context.t1 = _context.sent;\n\n              _context.t0.dispatch.call(_context.t0, _context.t1);\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x, _x2) {\n      return _ref.apply(this, arguments);\n    };\n  }());\n}\n\nfunction convertDuration(time) {\n  var hour = Math.floor(time / 3600 % 24);\n  var min = Math.floor(time / 60 % 60);\n  var sec = Math.floor(time % 60);\n\n  if (hour >= 1 && min === 0 && sec === 0) {\n    return \"\".concat(hour, \":00:00\");\n  } else if (hour >= 1 && min !== 0 && sec === 0) {\n    return \"\".concat(hour, \":\").concat(min, \":00\");\n  } else if (hour >= 1 && min !== 0 && sec !== 0) {\n    return \"\".concat(hour, \":\").concat(min, \":\").concat(sec);\n  } else if (min >= 1 && sec === 0) {\n    return \"\".concat(min, \":00\");\n  } else if (min >= 1 && sec !== 0) {\n    return \"\".concat(min, \":\").concat(sec);\n  } else {\n    return \"0:\".concat(sec);\n  }\n\n  return '0:0';\n}\n\nfunction convertViews(views) {\n  if (views < 10000) {\n    return views;\n  }\n\n  return (views / 10000).toFixed(1) + 'ä¸‡';\n}\n\nvar RecommendUI = /*#__PURE__*/function (_React$Component) {\n  _inherits(RecommendUI, _React$Component);\n\n  var _super = _createSuper(RecommendUI);\n\n  function RecommendUI(props) {\n    var _this2;\n\n    _classCallCheck(this, RecommendUI);\n\n    _this2 = _super.call(this, props);\n    _this2.state = {\n      offsetTop: 0\n    };\n    return _this2;\n  }\n\n  _createClass(RecommendUI, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.setState({\n        offsetTop: this.box.offsetTop\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var data = this.props.data;\n      return /*#__PURE__*/_jsx(_Fragment, {\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"rcmd-item\",\n          onClick: function onClick() {\n            return console.log('post');\n          },\n          ref: function ref(box) {\n            return _this3.box = box;\n          },\n          style: {\n            visibility: this.state.offsetTop > this.props.position + 540 || this.state.offsetTop < this.props.position - 540 ? 'hidden' : 'visible'\n          },\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"rcmd-item-info-wrapper\",\n            children: [/*#__PURE__*/_jsx(\"img\", {\n              src: data.pic,\n              alt: data.title,\n              className: \"rcmd-item-image\",\n              style: {\n                display: this.state.offsetTop > this.props.position + 540 || this.state.offsetTop < this.props.position - 540 ? 'none' : 'block'\n              }\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"rcmd-item-stat\",\n              children: [/*#__PURE__*/_jsx(\"span\", {\n                className: \"rcmd-item-duration\",\n                children: convertDuration(data.duration)\n              }), /*#__PURE__*/_jsxs(\"span\", {\n                className: \"rcmd-item-views\",\n                children: [convertViews(data.stat.view), \"\\u89C2\\u770B\"]\n              })]\n            })]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"rcmd-item-title-wrapper\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"rcmd-item-owner\",\n              children: /*#__PURE__*/_jsx(\"img\", {\n                src: data.owner.face,\n                alt: data.owner.name,\n                style: {\n                  display: this.state.offsetTop > this.props.position + 540 || this.state.offsetTop < this.props.position - 540 ? 'none' : 'block'\n                }\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"rcmd-item-title\",\n              children: /*#__PURE__*/_jsx(\"strong\", {\n                children: data.title\n              })\n            })]\n          })]\n        })\n      });\n    }\n  }]);\n\n  return RecommendUI;\n}(React.Component);\n\nvar Recommend = /*#__PURE__*/function (_React$Component2) {\n  _inherits(Recommend, _React$Component2);\n\n  var _super2 = _createSuper(Recommend);\n\n  function Recommend(props) {\n    var _this4;\n\n    _classCallCheck(this, Recommend);\n\n    _this4 = _super2.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this4), \"loadMore\", function () {\n      var _this = _assertThisInitialized(_this4);\n\n      if (ipcRenderer) {\n        ipcRenderer.invoke('request_recommend_list_append').then(function (data) {\n          _this.setState({\n            recommendList: _this.state.recommendList.concat(data.item)\n          });\n        });\n      }\n    });\n\n    _this4.state = {\n      recommendList: []\n    };\n    return _this4;\n  }\n\n  _createClass(Recommend, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this5 = this;\n\n      var _this = this;\n\n      this.unsubscribe = store.subscribe(function () {\n        _this5.setState({\n          recommendList: store.getState().recommendList\n        }, function () {\n          setTimeout(function () {\n            _this.unsubscribe();\n          }, 2000);\n        });\n      });\n    }\n  }, {\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps, nextState, nextContext) {\n      if (nextProps.loading) {\n        this.loadMore();\n      }\n\n      return true;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this6 = this;\n\n      return /*#__PURE__*/_jsx(_Fragment, {\n        children: this.state.recommendList.map(function (list, index) {\n          return /*#__PURE__*/_jsx(RecommendUI, _objectSpread({\n            data: list\n          }, _this6.props), index);\n        })\n      });\n    }\n  }]);\n\n  return Recommend;\n}(React.Component);\n\nexport { Recommend as default };","map":null,"metadata":{},"sourceType":"module"}