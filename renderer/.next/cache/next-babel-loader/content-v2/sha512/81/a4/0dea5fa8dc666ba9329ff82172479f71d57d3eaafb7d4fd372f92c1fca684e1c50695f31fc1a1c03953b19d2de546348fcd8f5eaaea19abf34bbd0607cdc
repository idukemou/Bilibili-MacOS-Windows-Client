{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/renderer/components/common/videoDetail.jsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { useEffect, useState, use } from \"react\";\nimport store from \"../../redux/store\";\nimport { platVideoStatusAction, playVideoInfoAction } from \"../../redux/actionCreators\";\nimport Player from \"../../utils/Player\";\nimport { convertDuration, convertTime } from \"../../utils/utils\";\nimport '../../styles/videoPlayer.css';\n\nfunction MediaPlayer(props) {\n  _s();\n\n  var _useState = useState(null),\n      player = _useState[0],\n      setPlayer = _useState[1];\n\n  var _useState2 = useState(null),\n      mediaContainer = _useState2[0],\n      setMediaContainer = _useState2[1];\n\n  var _useState3 = useState(store.getState().videoInfo.url),\n      url = _useState3[0],\n      setUrl = _useState3[1];\n\n  var _useState4 = useState(false),\n      ready = _useState4[0],\n      setReady = _useState4[1];\n\n  var _useState5 = useState(false),\n      isMuted = _useState5[0],\n      setIsMuted = _useState5[1];\n\n  var processor = null;\n  useEffect(function () {\n    var unsubscribe = store.subscribe(function () {\n      if (JSON.stringify(store.getState().videoInfo.url) !== '{}') {\n        setUrl(store.getState().videoInfo.url.durl[0].url);\n        unsubscribe();\n      }\n    });\n\n    if (flvjs.isSupported() && url.length > 10) {\n      setPlayer(flvjs.createPlayer({\n        type: 'flv',\n        isLive: false,\n        hasVideo: true,\n        hasAudio: true,\n        url: url\n      }));\n      setMediaContainer(document.getElementById('media-container'));\n      setReady(true);\n    }\n  }, [url]);\n  useEffect(function () {\n    if (player !== null) {\n      initPlayer();\n    }\n  }, [ready]);\n\n  function initPlayer() {\n    if (player !== null && mediaContainer !== null) {\n      player.attachMediaElement(mediaContainer);\n      player.load();\n\n      mediaContainer.onloadeddata = function () {\n        play();\n      };\n    }\n  }\n\n  function play() {\n    if (player !== null) {\n      player.play().then(function () {\n        processor = setInterval(function () {\n          console.log(convertDuration(getCurrentTime()));\n        }, 1000);\n      })[\"catch\"](function (e) {});\n    }\n  }\n\n  function pause() {\n    player !== null && player.pause();\n  }\n\n  function destroy() {\n    if (player !== null) {\n      pause();\n      player.unload();\n      player.detachMediaElement();\n      player.destroy();\n      setPlayer(null);\n    }\n  }\n\n  function getCurrentTime() {\n    if (player !== null) {\n      return player.currentTime;\n    }\n\n    return -1;\n  }\n\n  function setCurrentTime(time) {\n    if (player !== null) {\n      player.currentTime = time;\n    }\n  }\n\n  function appendSeek(time) {\n    player.currentTime = player.currentTime + time;\n  }\n\n  function pushSeek() {\n    appendSeek(0.1);\n  }\n\n  function muteSwitcher() {\n    isMuted ? setIsMuted(false) : setIsMuted(true);\n  }\n\n  function quit() {\n    destroy();\n    props.quit();\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      width: 640,\n      height: 480,\n      border: '1px solid #000'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"video\", {\n      id: \"media-container\",\n      width: \"640px\",\n      height: \"480px\",\n      controls: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: function onClick() {\n        return quit();\n      },\n      children: \"\\u9000\\u51FA\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"progress-bar-wrapper\",\n      children: /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"range\",\n        min: \"0\",\n        max: \"100\",\n        className: \"progress-bar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 117,\n    columnNumber: 9\n  }, this);\n}\n/**\n *\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\n\n\n_s(MediaPlayer, \"9egAvyj5bCyvbfwT+o8EJ1kfFHU=\");\n\n_c = MediaPlayer;\nexport default function VideoDetail(props) {\n  _s2();\n\n  var _useState6 = useState(store.getState().playVideoStatus),\n      status = _useState6[0],\n      setStatus = _useState6[1];\n\n  useEffect(function () {\n    store.subscribe(function () {\n      setStatus(store.getState().playVideoStatus);\n    });\n  }, [store.getState().playVideoStatus]);\n\n  function exitVideo() {\n    store.dispatch(platVideoStatusAction(false));\n    store.dispatch(playVideoInfoAction({\n      url: {},\n      info: {}\n    }));\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    style: {\n      position: 'absolute',\n      top: 0,\n      left: 0,\n      right: 0,\n      bottom: 0,\n      zIndex: '10000',\n      backgroundColor: 'lightpink',\n      display: status ? 'block' : 'none'\n    },\n    children: [status && /*#__PURE__*/_jsxDEV(MediaPlayer, {\n      quit: exitVideo\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 27\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 18\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 23\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 28\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 164,\n    columnNumber: 9\n  }, this);\n}\n\n_s2(VideoDetail, \"1IV1QrlNWNfANAKMe6lxWYK5QPg=\");\n\n_c2 = VideoDetail;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"MediaPlayer\");\n$RefreshReg$(_c2, \"VideoDetail\");","map":{"version":3,"sources":["/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/renderer/components/common/videoDetail.jsx"],"names":["useEffect","useState","use","store","platVideoStatusAction","playVideoInfoAction","Player","convertDuration","convertTime","MediaPlayer","props","player","setPlayer","mediaContainer","setMediaContainer","getState","videoInfo","url","setUrl","ready","setReady","isMuted","setIsMuted","processor","unsubscribe","subscribe","JSON","stringify","durl","flvjs","isSupported","length","createPlayer","type","isLive","hasVideo","hasAudio","document","getElementById","initPlayer","attachMediaElement","load","onloadeddata","play","then","setInterval","console","log","getCurrentTime","e","pause","destroy","unload","detachMediaElement","currentTime","setCurrentTime","time","appendSeek","pushSeek","muteSwitcher","quit","width","height","border","VideoDetail","playVideoStatus","status","setStatus","exitVideo","dispatch","info","position","top","left","right","bottom","zIndex","backgroundColor","display"],"mappings":"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","sourcesContent":["import {useEffect, useState, use} from \"react\";\nimport store from \"../../redux/store\";\nimport {platVideoStatusAction, playVideoInfoAction} from \"../../redux/actionCreators\";\nimport Player from \"../../utils/Player\";\nimport {convertDuration, convertTime} from \"../../utils/utils\";\nimport '../../styles/videoPlayer.css';\n\nfunction MediaPlayer(props){\n    const [player, setPlayer] = useState(null);\n    const [mediaContainer, setMediaContainer] = useState(null);\n    const [url, setUrl] = useState(store.getState().videoInfo.url);\n    const [ready, setReady] = useState(false);\n    const [isMuted, setIsMuted] = useState(false);\n    let processor = null;\n\n\n\n\n    useEffect(() => {\n        let unsubscribe = store.subscribe(() => {\n            if(JSON.stringify(store.getState().videoInfo.url) !== '{}'){\n                setUrl(store.getState().videoInfo.url.durl[0].url);\n                unsubscribe();\n            }\n        })\n\n        if(flvjs.isSupported() && url.length > 10){\n            setPlayer(flvjs.createPlayer({\n                type: 'flv',\n                isLive: false,\n                hasVideo: true,\n                hasAudio: true,\n                url: url\n            }));\n            setMediaContainer(document.getElementById('media-container'));\n            setReady(true);\n        }\n    }, [url]);\n\n    useEffect(() => {\n        if(player !== null){\n            initPlayer();\n        }\n    }, [ready]);\n\n    function initPlayer(){\n        if(player !== null && mediaContainer !== null){\n            player.attachMediaElement(mediaContainer);\n            player.load();\n            mediaContainer.onloadeddata = () => {\n                play();\n            }\n        }\n    }\n\n    function play(){\n        if(player !== null){\n            player.play()\n                .then(() => {\n                    processor = setInterval(() => {\n                         console.log(convertDuration(getCurrentTime()));\n                    }, 1000);\n                })\n                .catch((e) => {});\n        }\n    }\n\n    function pause(){\n        player !== null && player.pause();\n    }\n\n    function destroy(){\n        if(player !== null){\n            pause();\n            player.unload();\n            player.detachMediaElement();\n            player.destroy();\n            setPlayer(null);\n        }\n    }\n\n    function getCurrentTime(){\n        if(player !== null){\n            return player.currentTime;\n        }\n        return -1;\n    }\n\n    function setCurrentTime(time){\n        if(player !== null){\n            player.currentTime = time;\n        }\n    }\n\n    function appendSeek(time){\n        player.currentTime = player.currentTime + time;\n    }\n\n    function pushSeek(){\n        appendSeek(0.1);\n    }\n\n    function muteSwitcher(){\n        isMuted ? setIsMuted(false) : setIsMuted(true);\n    }\n\n    function quit(){\n        destroy();\n        props.quit();\n    }\n\n\n\n\n\n    return(\n        <div style={{width:640, height:480, border: '1px solid #000'}}>\n            <video id='media-container' width='640px' height='480px' controls={true} />\n            {/*<button onClick={() => flvPlayer.play()}>play</button>*/}\n            {/*<button onClick={() => flvPlayer.pause()}>pause</button>*/}\n            {/*<button onClick={() => flvPlayer.destroy()}>destroy</button>*/}\n            {/*<button onClick={() => flvPlayer.setCurrentTime(10)}>加10秒</button>*/}\n            {/*<button onClick={() => flvPlayer.muteSwitch()}>静音</button>*/}\n            {/*<button onClick={() => {console.log(flvPlayer.getDuration())}}>获取播放长度</button>*/}\n            {/*<button onClick={() => flvPlayer.setPlaySpeed(2)}>2x速度</button>*/}\n            {/*<button onClick={() => flvPlayer.replayVideo()}>重新播放</button><br/><br/>*/}\n            <button onClick={() => quit()}>退出</button>\n\n            <div className=\"progress-bar-wrapper\">\n                <input type=\"range\" min=\"0\" max=\"100\" className=\"progress-bar\"/>\n            </div>\n\n        </div>\n    )\n}\n\n\n/**\n *\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\nexport default function VideoDetail(props){\n\n    const [status, setStatus] = useState(store.getState().playVideoStatus);\n\n    useEffect(() => {\n        store.subscribe(() => {\n            setStatus(store.getState().playVideoStatus);\n        })\n    }, [store.getState().playVideoStatus]);\n\n\n    function exitVideo(){\n        store.dispatch(platVideoStatusAction(false));\n        store.dispatch(playVideoInfoAction({\n            url: {},\n            info: {}\n        }));\n    }\n\n    return(\n        <section style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            right: 0,\n            bottom: 0,\n            zIndex: '10000',\n            backgroundColor: 'lightpink',\n            display: (status ? 'block': 'none')\n        }}>\n            {\n                status && <MediaPlayer quit={exitVideo} />\n            }\n            <br/><br/><br/><br/>\n        </section>\n    )\n}"]},"metadata":{},"sourceType":"module"}