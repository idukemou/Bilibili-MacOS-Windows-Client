{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport \"antd/lib/popover/style/css\";\nimport _Popover from \"antd/lib/popover\";\nimport \"antd/lib/slider/style/css\";\nimport _Slider from \"antd/lib/slider\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/renderer/components/common/videoDetail.jsx\";\nimport { useEffect, useRef, useState } from \"react\";\nimport store from \"../../redux/store\";\nimport { platVideoStatusAction, playVideoInfoAction } from \"../../redux/actionCreators\";\nimport { convertDuration } from \"../../utils/utils\";\nimport '../../styles/videoPlayer.css';\n\nfunction MediaPlayer(props) {\n  const progressRef = useRef(null);\n  const playerRef = useRef(null);\n  const {\n    0: player,\n    1: setPlayer\n  } = useState(null);\n  const {\n    0: mediaContainer,\n    1: setMediaContainer\n  } = useState(null);\n  const {\n    0: url,\n    1: setUrl\n  } = useState(store.getState().videoInfo.url);\n  const {\n    0: ready,\n    1: setReady\n  } = useState(false);\n  const {\n    0: isPlay,\n    1: setIsPlay\n  } = useState(false);\n  const {\n    0: isMuted,\n    1: setIsMuted\n  } = useState(false);\n  const {\n    0: isFullScreen,\n    1: setIsFullScreen\n  } = useState(false);\n  const {\n    0: processTime,\n    1: setProcessTime\n  } = useState(0);\n  const {\n    0: duration,\n    1: setDuration\n  } = useState(0);\n  const {\n    0: bufferedTime,\n    1: setBufferedTime\n  } = useState(0);\n  const {\n    0: processor,\n    1: setProcessor\n  } = useState(null);\n  const {\n    0: volume,\n    1: setVolume\n  } = useState(100);\n  const {\n    0: speedRate,\n    1: setSpeedRate\n  } = useState(1);\n  useEffect(() => {\n    let unsubscribe = store.subscribe(() => {\n      if (JSON.stringify(store.getState().videoInfo.url) !== '{}') {\n        setUrl(store.getState().videoInfo.url.durl[0].url);\n        unsubscribe();\n      }\n    });\n\n    if (flvjs.isSupported() && url.length > 10) {\n      setPlayer(flvjs.createPlayer({\n        type: 'flv',\n        isLive: false,\n        hasVideo: true,\n        hasAudio: true,\n        url: url\n      }, {\n        lazyLoad: false\n      }));\n      setMediaContainer(document.getElementById('media-player'));\n      setReady(true);\n    }\n  }, [url]);\n  useEffect(() => {\n    if (player !== null) {\n      initPlayer();\n    }\n  }, [ready]);\n\n  function initPlayer() {\n    if (player !== null && mediaContainer !== null) {\n      player.attachMediaElement(mediaContainer);\n      player.unload();\n      player.load();\n\n      mediaContainer.onloadeddata = () => {\n        play();\n        setDuration(getDuration());\n        setVolume(getPlayerVolume());\n      };\n\n      mediaContainer.onplay = () => {\n        clearInterval(processor);\n        setIsPlay(true);\n        setProcessor(setInterval(() => {\n          setProcessTime(getCurrentTime());\n        }, speedRate * 1000));\n      };\n\n      mediaContainer.onended = () => {\n        clearInterval(processor);\n      };\n\n      mediaContainer.onprogress = () => {\n        if (mediaContainer.buffered.length > 0) {\n          setBufferedTime(mediaContainer.buffered.end(0));\n        }\n      };\n    }\n  }\n\n  function play() {\n    if (player !== null) {\n      player.play().then(() => {}).catch(e => {});\n    }\n  }\n\n  function pause() {\n    clearInterval(processor);\n\n    if (player !== null) {\n      player.pause();\n      setIsPlay(false);\n    }\n  }\n\n  function destroy() {\n    if (player !== null) {\n      clearInterval(processor);\n      pause();\n      player.unload();\n      player.detachMediaElement();\n      player.destroy();\n      setPlayer(null);\n    }\n  }\n\n  function getCurrentTime() {\n    if (player === null) return 0;\n\n    if (convertDuration(player.currentTime) === convertDuration(player.duration)) {\n      return player.duration;\n    } else {\n      return player.currentTime;\n    }\n  }\n\n  function setCurrentTime(time) {\n    if (player !== null) {\n      player.currentTime = time;\n    }\n  }\n\n  function appendSeek(time) {\n    player.currentTime = player.currentTime + time;\n  }\n\n  function pushSeek() {\n    appendSeek(0.125);\n  }\n\n  function getDuration() {\n    if (player !== null) {\n      return player.duration;\n    }\n\n    return 0;\n  }\n\n  function setPlayerVolume(volume) {\n    if (player !== null) {\n      player.volume = volume / 100;\n    }\n  }\n\n  function getPlayerVolume() {\n    if (player !== null) {\n      return player.volume;\n    }\n  }\n\n  function muteSwitcher() {\n    if (isMuted && player !== null) {\n      player.muted = false;\n      setIsMuted(false);\n    } else {\n      player.muted = true;\n      setIsMuted(true);\n    }\n  }\n\n  function playSwitcher() {\n    isPlay ? pause() : play();\n  }\n\n  function replay() {\n    if (player !== null) {\n      pause();\n      setCurrentTime(0);\n      play();\n    }\n  }\n\n  function setPlayerSpeedRate(rate) {\n    if (mediaContainer !== null) {\n      mediaContainer.playbackRate = rate;\n      setSpeedRate(rate);\n    }\n  }\n\n  function handleChangeVolume(value) {\n    setPlayerVolume(value);\n\n    if (value > 0) {\n      setIsMuted(false);\n    } else {\n      setIsMuted(true);\n    }\n  }\n\n  function handleProgressChange({\n    target: {\n      value\n    }\n  }) {\n    pause();\n    setProcessTime(value);\n  }\n\n  function mouseDownEvent() {\n    setProcessTime(progressRef.current.value);\n  }\n\n  function mouseUpEvent() {\n    if (processTime >= bufferedTime) {\n      setTimeout(() => {\n        pushSeek();\n      }, 1000);\n    }\n\n    if (mediaContainer.buffered.length > 0) {\n      if (processTime <= mediaContainer.buffered.start(0)) {\n        setTimeout(() => {\n          pushSeek();\n        }, 1000);\n      }\n    }\n\n    setCurrentTime(processTime);\n    play();\n    console.log(\"Finished, \", convertDuration(processTime));\n  }\n\n  function fullscreen() {\n    if (!isFullScreen) {\n      playerRef.current.requestFullscreen();\n      setIsFullScreen(true);\n    } else {\n      document.exitFullscreen();\n    }\n\n    playerRef.current.addEventListener('fullscreenchange', () => {\n      const state = document.fullScreen || document.mozFullScreen || document.webkitIsFullScreen;\n      !state && setIsFullScreen(false);\n    });\n  }\n\n  function close() {\n    destroy();\n    props.quit();\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"media-player-container\",\n      ref: playerRef,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"media-title-wrapper\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"media-button media-control-close\",\n          onClick: () => close(),\n          children: /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"iconfont icon-close\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 258,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: props.title\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 255,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n        id: \"media-player\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"media-controls\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"progress-bar-wrapper\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: convertDuration(processTime)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 269,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            ref: progressRef,\n            type: \"range\",\n            min: 0,\n            max: duration,\n            value: processTime,\n            onInput: e => handleProgressChange(e),\n            onMouseUp: () => mouseUpEvent(),\n            onMouseDown: () => mouseDownEvent(),\n            className: \"progress-bar\",\n            style: {\n              background: `linear-gradient(to right, \n                                                   rgb(250, 107, 147) 0%, rgb(250, 107, 147) ${processTime / duration * 100}%, \n                                                   #777 ${processTime / duration * 100}%, #777 ${bufferedTime / duration * 100}%, \n                                                   #444 ${bufferedTime / duration * 100}%, #444 100%\n                                            )`\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 270,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: convertDuration(duration)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 288,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 268,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"media-control-buttons\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"media-button media-control-play\",\n            onClick: () => playSwitcher(),\n            children: isPlay ? /*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"iconfont icon-zanting\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 294,\n              columnNumber: 42\n            }, this) : /*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"iconfont icon-bofang\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 294,\n              columnNumber: 84\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 292,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"media-button media-control-speed\",\n            onClick: () => setPlayerSpeedRate(2),\n            children: \"2X\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"media-button media-control-speed\",\n            onClick: () => setPlayerSpeedRate(1),\n            children: \"\\u539F\\u901F\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 298,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(_Popover, {\n            content: /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                height: 120\n              },\n              children: /*#__PURE__*/_jsxDEV(_Slider, {\n                vertical: true,\n                defaultValue: 100,\n                onChange: e => handleChangeVolume(e)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 303,\n                columnNumber: 37\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 302,\n              columnNumber: 33\n            }, this),\n            placement: \"top\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"media-button media-control-mute\",\n              onClick: () => muteSwitcher(),\n              children: isMuted ? /*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"iconfont icon-jingyin\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 310,\n                columnNumber: 47\n              }, this) : /*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"iconfont icon-yinliang\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 310,\n                columnNumber: 88\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 308,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 300,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"media-button media-control-replay\",\n            onClick: () => replay(),\n            children: /*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"iconfont icon-replay\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 316,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 315,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"media-button media-control-fullscreen\",\n            onClick: () => fullscreen(),\n            children: isFullScreen ? /*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"iconfont icon-fullscreen-exit\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 321,\n              columnNumber: 47\n            }, this) : /*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"iconfont icon-fangda\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 321,\n              columnNumber: 96\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 319,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 291,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 13\n    }, this)\n  }, void 0, false);\n}\n\nfunction MediaInfo(props) {\n  const {\n    0: active,\n    1: setActive\n  } = useState(0);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"video-detail-info-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"video-detail-info-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"video-detail-info-header-option\",\n        onClick: () => setActive(0),\n        children: \"\\u7B80\\u4ECB\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 339,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"video-detail-info-header-option\",\n        onClick: () => setActive(1),\n        children: [\"\\u8BC4\\u4EF7 \", /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"123\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 340,\n          columnNumber: 101\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 340,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"video-detail-info-content\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"video-detail-info-content-item\",\n        children: /*#__PURE__*/_jsxDEV(BriefIntro, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 345,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 344,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"video-detail-info-content-item\",\n        children: /*#__PURE__*/_jsxDEV(VideoReviews, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 348,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 347,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 343,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 337,\n    columnNumber: 9\n  }, this);\n}\n\nfunction BriefIntro(props) {\n  return /*#__PURE__*/_jsxDEV(\"span\", {\n    children: \"intro\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 357,\n    columnNumber: 9\n  }, this);\n}\n\nfunction VideoReviews(props) {\n  return /*#__PURE__*/_jsxDEV(\"span\", {\n    children: \"reviews\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 363,\n    columnNumber: 9\n  }, this);\n}\n/**\n *\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\n\n\nexport default function VideoDetail(props) {\n  const {\n    0: status,\n    1: setStatus\n  } = useState(store.getState().playVideoStatus);\n  const {\n    0: videoInfo,\n    1: setVideoInfo\n  } = useState(store.getState().videoInfo.info);\n  useEffect(() => {\n    const unsubscribe = store.subscribe(() => {\n      if (JSON.stringify(store.getState().videoInfo.info) !== '{}') {\n        setVideoInfo(store.getState().videoInfo.info);\n        setTimeout(() => {\n          unsubscribe();\n        }, 2000);\n      }\n    });\n  }, [store.getState().videoInfo.info]);\n  useEffect(() => {\n    store.subscribe(() => {\n      setStatus(store.getState().playVideoStatus);\n    });\n  }, [store.getState().playVideoStatus]);\n\n  function exitVideo() {\n    store.dispatch(platVideoStatusAction(false));\n    store.dispatch(playVideoInfoAction({\n      url: {},\n      info: {}\n    }));\n    setVideoInfo({});\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    style: {\n      position: 'absolute',\n      top: 0,\n      left: 0,\n      right: 0,\n      bottom: 0,\n      zIndex: '100',\n      width: \"100%\",\n      height: \"100%\",\n      backgroundColor: '#fff',\n      display: status ? 'block' : 'none',\n      overflow: \"scroll\"\n    },\n    children: [status && /*#__PURE__*/_jsxDEV(MediaPlayer, {\n      quit: exitVideo,\n      title: videoInfo.title\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 420,\n      columnNumber: 27\n    }, this), /*#__PURE__*/_jsxDEV(MediaInfo, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 423,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 406,\n    columnNumber: 9\n  }, this);\n}","map":{"version":3,"sources":["/Users/yuxuan/Desktop/Bilibili-MacOS-Windows-Client/renderer/components/common/videoDetail.jsx"],"names":["useEffect","useRef","useState","store","platVideoStatusAction","playVideoInfoAction","convertDuration","MediaPlayer","props","progressRef","playerRef","player","setPlayer","mediaContainer","setMediaContainer","url","setUrl","getState","videoInfo","ready","setReady","isPlay","setIsPlay","isMuted","setIsMuted","isFullScreen","setIsFullScreen","processTime","setProcessTime","duration","setDuration","bufferedTime","setBufferedTime","processor","setProcessor","volume","setVolume","speedRate","setSpeedRate","unsubscribe","subscribe","JSON","stringify","durl","flvjs","isSupported","length","createPlayer","type","isLive","hasVideo","hasAudio","lazyLoad","document","getElementById","initPlayer","attachMediaElement","unload","load","onloadeddata","play","getDuration","getPlayerVolume","onplay","clearInterval","setInterval","getCurrentTime","onended","onprogress","buffered","end","then","catch","e","pause","destroy","detachMediaElement","currentTime","setCurrentTime","time","appendSeek","pushSeek","setPlayerVolume","muteSwitcher","muted","playSwitcher","replay","setPlayerSpeedRate","rate","playbackRate","handleChangeVolume","value","handleProgressChange","target","mouseDownEvent","current","mouseUpEvent","setTimeout","start","console","log","fullscreen","requestFullscreen","exitFullscreen","addEventListener","state","fullScreen","mozFullScreen","webkitIsFullScreen","close","quit","title","background","height","MediaInfo","active","setActive","BriefIntro","VideoReviews","VideoDetail","status","setStatus","playVideoStatus","setVideoInfo","info","exitVideo","dispatch","position","top","left","right","bottom","zIndex","width","backgroundColor","display","overflow"],"mappings":"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","sourcesContent":["import {useEffect, useRef, useState} from \"react\";\nimport store from \"../../redux/store\";\nimport {platVideoStatusAction, playVideoInfoAction} from \"../../redux/actionCreators\";\nimport {convertDuration} from \"../../utils/utils\";\nimport '../../styles/videoPlayer.css';\nimport {Popover, Slider} from \"antd\";\n\nfunction MediaPlayer(props){\n    const progressRef = useRef(null);\n    const playerRef = useRef(null);\n\n    const [player, setPlayer] = useState(null);\n    const [mediaContainer, setMediaContainer] = useState(null);\n    const [url, setUrl] = useState(store.getState().videoInfo.url);\n    const [ready, setReady] = useState(false);\n\n    const [isPlay, setIsPlay] = useState(false);\n    const [isMuted, setIsMuted] = useState(false);\n    const [isFullScreen, setIsFullScreen] = useState(false);\n\n    const [processTime, setProcessTime] = useState(0);\n    const [duration, setDuration] = useState(0);\n    const [bufferedTime, setBufferedTime] = useState(0);\n    const [processor, setProcessor] = useState(null);\n    const [volume, setVolume] = useState(100);\n    const [speedRate, setSpeedRate] = useState(1);\n\n\n\n    useEffect(() => {\n        let unsubscribe = store.subscribe(() => {\n            if(JSON.stringify(store.getState().videoInfo.url) !== '{}'){\n                setUrl(store.getState().videoInfo.url.durl[0].url);\n                unsubscribe();\n            }\n        })\n\n        if(flvjs.isSupported() && url.length > 10){\n            setPlayer(flvjs.createPlayer({\n                type: 'flv',\n                isLive: false,\n                hasVideo: true,\n                hasAudio: true,\n                url: url\n            }, {\n                lazyLoad: false,\n            }));\n            setMediaContainer(document.getElementById('media-player'));\n            setReady(true);\n        }\n    }, [url]);\n\n    useEffect(() => {\n        if(player !== null){\n            initPlayer();\n        }\n    }, [ready]);\n\n    function initPlayer(){\n        if(player !== null && mediaContainer !== null){\n            player.attachMediaElement(mediaContainer);\n            player.unload();\n            player.load();\n\n            mediaContainer.onloadeddata = () => {\n                play();\n                setDuration(getDuration());\n                setVolume(getPlayerVolume());\n            }\n\n            mediaContainer.onplay = () => {\n                clearInterval(processor);\n                setIsPlay(true);\n                setProcessor(setInterval(() => {\n                    setProcessTime(getCurrentTime());\n                }, speedRate * 1000))\n            }\n\n            mediaContainer.onended = () => {\n                clearInterval(processor);\n            }\n\n            mediaContainer.onprogress = () => {\n                if(mediaContainer.buffered.length > 0){\n                    setBufferedTime(mediaContainer.buffered.end(0));\n                }\n            }\n        }\n    }\n\n    function play(){\n        if(player !== null){\n            player.play()\n                .then(() => {})\n                .catch((e) => {});\n        }\n    }\n\n    function pause(){\n        clearInterval(processor);\n        if (player !== null){\n            player.pause();\n            setIsPlay(false);\n        }\n    }\n\n    function destroy(){\n        if(player !== null){\n            clearInterval(processor);\n            pause();\n            player.unload();\n            player.detachMediaElement();\n            player.destroy();\n            setPlayer(null);\n        }\n    }\n\n    function getCurrentTime(){\n        if (player === null) return 0;\n\n        if(convertDuration(player.currentTime) === convertDuration(player.duration)){\n            return player.duration;\n        }else{\n            return player.currentTime;\n        }\n    }\n\n    function setCurrentTime(time){\n        if(player !== null){\n            player.currentTime = time;\n        }\n    }\n\n    function appendSeek(time){\n        player.currentTime = player.currentTime + time;\n    }\n\n    function pushSeek(){\n        appendSeek(0.125);\n    }\n\n    function getDuration(){\n        if(player !== null){\n            return player.duration;\n        }\n        return 0;\n    }\n\n    function setPlayerVolume(volume){\n        if(player !== null){\n            player.volume = volume / 100;\n        }\n    }\n\n    function getPlayerVolume(){\n        if(player !== null){\n            return player.volume;\n        }\n    }\n\n    function muteSwitcher(){\n        if(isMuted && player !== null){\n            player.muted = false;\n            setIsMuted(false);\n        }else{\n            player.muted = true;\n            setIsMuted(true);\n        }\n    }\n\n    function playSwitcher(){\n        isPlay ? pause(): play();\n    }\n\n    function replay(){\n        if(player !== null){\n            pause();\n            setCurrentTime(0);\n            play();\n        }\n    }\n\n    function setPlayerSpeedRate(rate){\n        if(mediaContainer !== null){\n            mediaContainer.playbackRate = rate;\n            setSpeedRate(rate);\n        }\n    }\n\n    function handleChangeVolume(value){\n        setPlayerVolume(value);\n\n        if(value > 0){\n            setIsMuted(false);\n        }else{\n            setIsMuted(true);\n        }\n    }\n\n    function handleProgressChange({target: {value}}){\n        pause();\n        setProcessTime(value);\n    }\n\n    function mouseDownEvent(){\n        setProcessTime(progressRef.current.value);\n    }\n\n    function mouseUpEvent(){\n        if(processTime >= bufferedTime){\n            setTimeout(() => {\n                pushSeek();\n            }, 1000);\n        }\n\n        if(mediaContainer.buffered.length > 0){\n            if(processTime <= mediaContainer.buffered.start(0)){\n                setTimeout(() => {\n                    pushSeek();\n                }, 1000);\n            }\n        }\n\n        setCurrentTime(processTime);\n        play();\n\n        console.log(\"Finished, \", convertDuration(processTime));\n    }\n\n    function fullscreen(){\n        if(!isFullScreen){\n            playerRef.current.requestFullscreen();\n            setIsFullScreen(true);\n        }else{\n            document.exitFullscreen();\n        }\n\n        playerRef.current.addEventListener('fullscreenchange', () => {\n            const state = document.fullScreen || document.mozFullScreen || document.webkitIsFullScreen;\n            !state && setIsFullScreen(false);\n\n        })\n    }\n\n    function close(){\n        destroy();\n        props.quit();\n    }\n\n\n    return(\n        <>\n            <div className=\"media-player-container\" ref={playerRef}>\n\n                <div className=\"media-title-wrapper\">\n                    <button className=\"media-button media-control-close\" onClick={() => close()}>\n                        {\n                            <i className=\"iconfont icon-close\" />\n                        }\n                    </button>\n\n                    <span>{props.title}</span>\n                </div>\n\n                <video id='media-player'/>\n\n                <div className=\"media-controls\">\n                    <div className=\"progress-bar-wrapper\">\n                        <span>{convertDuration(processTime)}</span>\n                        <input\n                            ref={progressRef}\n                            type=\"range\"\n                            min={0}\n                            max={duration}\n                            value={processTime}\n                            onInput={(e) => handleProgressChange(e)}\n                            onMouseUp={() => mouseUpEvent()}\n                            onMouseDown={() => mouseDownEvent()}\n                            className=\"progress-bar\"\n                            style={{\n                                background: `linear-gradient(to right, \n                                                   rgb(250, 107, 147) 0%, rgb(250, 107, 147) ${(processTime/duration) * 100}%, \n                                                   #777 ${(processTime/duration) * 100}%, #777 ${(bufferedTime/duration) * 100}%, \n                                                   #444 ${(bufferedTime/duration) * 100}%, #444 100%\n                                            )`\n                            }}\n                        />\n                        <span>{convertDuration(duration)}</span>\n                    </div>\n\n                    <div className=\"media-control-buttons\">\n                        <button className=\"media-button media-control-play\" onClick={() => playSwitcher()}>\n                            {\n                                isPlay ? <i className=\"iconfont icon-zanting\" /> : <i className=\"iconfont icon-bofang\" />\n                            }\n                        </button>\n                        <button className=\"media-button media-control-speed\" onClick={() => setPlayerSpeedRate(2)}>2X</button>\n                        <button className=\"media-button media-control-speed\" onClick={() => setPlayerSpeedRate(1)}>原速</button>\n\n                        <Popover\n                            content={\n                                <div style={{height: 120}}>\n                                    <Slider vertical defaultValue={100} onChange={(e) => handleChangeVolume(e)} />\n                                </div>\n                            }\n                            placement=\"top\"\n                        >\n                            <button className=\"media-button media-control-mute\" onClick={() => muteSwitcher()}>\n                                {\n                                    isMuted ? <i className=\"iconfont icon-jingyin\"/> : <i className=\"iconfont icon-yinliang\" />\n                                }\n                            </button>\n                        </Popover>\n\n                        <button className=\"media-button media-control-replay\" onClick={() => replay()}>\n                            <i className=\"iconfont icon-replay\" />\n                        </button>\n\n                        <button className=\"media-button media-control-fullscreen\" onClick={() => fullscreen()}>\n                            {\n                                isFullScreen? <i className=\"iconfont icon-fullscreen-exit\"/> : <i className=\"iconfont icon-fangda\"/>\n                            }\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </>\n    )\n}\n\n\nfunction MediaInfo(props){\n\n    const [active, setActive] = useState(0);\n\n    return(\n        <div className=\"video-detail-info-container\">\n            <div className=\"video-detail-info-header\">\n                <button className=\"video-detail-info-header-option\" onClick={() => setActive(0)}>简介</button>\n                <button className=\"video-detail-info-header-option\" onClick={() => setActive(1)}>评价 <span>123</span></button>\n            </div>\n\n            <div className=\"video-detail-info-content\">\n                <div className=\"video-detail-info-content-item\">\n                    <BriefIntro/>\n                </div>\n                <div className=\"video-detail-info-content-item\">\n                    <VideoReviews/>\n                </div>\n            </div>\n        </div>\n    )\n}\n\nfunction BriefIntro(props){\n    return (\n        <span>intro</span>\n    )\n}\n\nfunction VideoReviews(props){\n    return(\n        <span>reviews</span>\n    )\n}\n\n/**\n *\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\nexport default function VideoDetail(props){\n\n    const [status, setStatus] = useState(store.getState().playVideoStatus);\n    const [videoInfo, setVideoInfo] = useState(store.getState().videoInfo.info);\n\n    useEffect(() => {\n        const unsubscribe = store.subscribe(() => {\n            if(JSON.stringify(store.getState().videoInfo.info) !== '{}'){\n                setVideoInfo(store.getState().videoInfo.info);\n                setTimeout(() => {\n                    unsubscribe();\n                }, 2000);\n            }\n        })\n    }, [store.getState().videoInfo.info]);\n\n    useEffect(() => {\n        store.subscribe(() => {\n            setStatus(store.getState().playVideoStatus);\n        })\n    }, [store.getState().playVideoStatus]);\n\n\n    function exitVideo(){\n        store.dispatch(platVideoStatusAction(false));\n        store.dispatch(playVideoInfoAction({\n            url: {},\n            info: {}\n        }));\n        setVideoInfo({});\n    }\n\n    return(\n        <section style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            right: 0,\n            bottom: 0,\n            zIndex: '100',\n            width: \"100%\",\n            height: \"100%\",\n            backgroundColor: '#fff',\n            display: (status ? 'block': 'none'),\n            overflow: \"scroll\"\n        }}>\n            {\n                status && <MediaPlayer quit={exitVideo} title={videoInfo.title} />\n            }\n\n            <MediaInfo/>\n        </section>\n    )\n}"]},"metadata":{},"sourceType":"module"}