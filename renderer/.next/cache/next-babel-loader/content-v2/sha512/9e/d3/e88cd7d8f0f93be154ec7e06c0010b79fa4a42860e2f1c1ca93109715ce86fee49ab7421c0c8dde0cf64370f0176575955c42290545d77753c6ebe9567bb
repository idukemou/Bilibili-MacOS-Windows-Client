{"ast":null,"code":"import \"antd/lib/input/style/css\";\nimport _Input from \"antd/lib/input\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useEffect, useRef, useState } from \"react\";\nimport '../../styles/login.css';\nimport Header from \"../layout/header\";\nimport store from \"../../redux/store\";\nimport electron from \"electron\";\nimport { getCountryListAction } from \"../../redux/actionCreators\";\nvar ipcRenderer = electron.ipcRenderer || false;\nvar captchaToken = {\n  gt: \"\",\n  challenge: \"\",\n  key: \"\",\n  validate: \"\",\n  seccode: \"\"\n};\n\nif (ipcRenderer) {\n  ipcRenderer.send(\"request_country_list\");\n  ipcRenderer.once(\"fetch_country_list\", function (event, data) {\n    store.dispatch(getCountryListAction(data));\n  });\n}\n/**\n * Country list panel.\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\n\n\nfunction CountryListSelect(props) {\n  var _useState = useState(store.getState().countryList),\n      countryList = _useState[0],\n      setCountryList = _useState[1];\n\n  var _useState2 = useState(false),\n      display = _useState2[0],\n      setDisplay = _useState2[1];\n\n  useEffect(function () {\n    setCountryList(store.getState().countryList);\n  }, [store.getState().countryList]);\n  useEffect(function () {\n    props.show && setDisplay(true);\n  }, [props.show]);\n\n  function closePanel() {\n    props.handleShowCountryList();\n    setTimeout(function () {\n      setDisplay(false);\n    }, 600);\n  }\n\n  function selectCountry(data) {\n    props.changeCountry(data);\n    closePanel();\n  }\n\n  return /*#__PURE__*/_jsxs(\"section\", {\n    className: \"login-panel-wrapper country-selector-wrapper country-selector-\".concat(props.show ? 'show' : 'hide'),\n    style: {\n      display: display ? 'block' : 'none'\n    },\n    children: [/*#__PURE__*/_jsx(Header, {\n      left: /*#__PURE__*/_jsx(\"span\", {\n        className: \"iconfont icon-back login-close-btn\",\n        onClick: function onClick() {\n          return closePanel();\n        }\n      }),\n      center: /*#__PURE__*/_jsx(\"span\", {\n        children: \"\\u9009\\u62E9\\u56FD\\u5BB6\\u5730\\u533A\"\n      })\n    }), /*#__PURE__*/_jsx(\"section\", {\n      className: \"country-selector-content\",\n      children: countryList.map(function (countryItem) {\n        return /*#__PURE__*/_jsx(\"div\", {\n          className: \"country-list-item\",\n          onClick: function onClick() {\n            return selectCountry({\n              id: countryItem.id,\n              cname: countryItem.cname,\n              country_id: countryItem.country_id\n            });\n          },\n          children: countryItem.cname\n        }, countryItem.id);\n      })\n    })]\n  });\n}\n\nfunction CaptchaPanel(props) {\n  function appendCaptchaPanel(captcha) {\n    captcha.appendTo(document.getElementById(\"captcha-panel-wrapper\"));\n    captcha.onSuccess(function () {\n      var result = captcha.getValidate();\n      console.log([result.geetest_validate, result.geetest_seccode]);\n      captchaToken.validate = result.geetest_validate;\n      captchaToken.seccode = result.geetest_seccode;\n      props.setShowCaptchaPanel(false);\n      props.sendCaptchaCode();\n    });\n  }\n\n  function showCaptchaPanel() {\n    window.initGeetest({\n      gt: captchaToken.gt,\n      challenge: captchaToken.challenge,\n      offline: false,\n      new_captcha: true,\n      product: \"popup\",\n      width: \"340px\",\n      https: true\n    }, appendCaptchaPanel);\n  }\n\n  useEffect(function () {\n    showCaptchaPanel();\n  });\n  return /*#__PURE__*/_jsx(\"div\", {\n    id: \"captcha-panel-container\",\n    children: /*#__PURE__*/_jsx(\"div\", {\n      id: \"captcha-panel-wrapper\"\n    })\n  });\n}\n/**\n * Login main panel.\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\n\n\nexport default function LoginPanel(props) {\n  var data = {\n    loginMethod: {\n      smscode: \"smscode\",\n      password: \"password\",\n      unknown: \"unknown\"\n    },\n    title: {\n      smscode: \"手机号登录注册\",\n      password: \"密码登录\",\n      unknown: \"未知登录方式\"\n    }\n  }; // method: smscode | password | qrcode\n\n  var _useState3 = useState(data.loginMethod.smscode),\n      loginMethod = _useState3[0],\n      setLoginMethod = _useState3[1];\n\n  var _useState4 = useState(true),\n      show = _useState4[0],\n      setShow = _useState4[1];\n\n  var _useState5 = useState(),\n      tel = _useState5[0],\n      setTel = _useState5[1];\n\n  var _useState6 = useState(),\n      captchaCode = _useState6[0],\n      setCaptchaCode = _useState6[1];\n\n  var title = data.title[loginMethod];\n\n  var _useState7 = useState({\n    id: 1,\n    cname: \"中国大陆\",\n    country_id: 86\n  }),\n      country = _useState7[0],\n      setCountry = _useState7[1];\n\n  var _useState8 = useState(false),\n      showCountryList = _useState8[0],\n      setShowCountryList = _useState8[1];\n\n  var _useState9 = useState(false),\n      showCaptchaPanel = _useState9[0],\n      setShowCaptchaPanel = _useState9[1];\n\n  function closePenal() {\n    setShow(false);\n    setTimeout(function () {\n      props.display();\n    }, 600);\n  }\n\n  function changeLoginMethod() {\n    switch (loginMethod) {\n      case 'smscode':\n        setLoginMethod(data.loginMethod.password);\n        break;\n\n      case 'password':\n        setLoginMethod(data.loginMethod.smscode);\n        break;\n\n      default:\n        setLoginMethod(data.loginMethod.unknown);\n    }\n  }\n\n  function handleShowCountryList() {\n    setShowCountryList(!showCountryList);\n  }\n\n  function changeCountry(data) {\n    setCountry(data);\n  }\n\n  function displayCaptchaPanel() {\n    if (showCaptchaPanel === true || tel.length < 6) return;\n    ipcRenderer.invoke('request_captcha_token').then(function (data) {\n      captchaToken.gt = data.gt;\n      captchaToken.challenge = data.challenge;\n      captchaToken.key = data.key;\n      return true;\n    }).then(function (res) {\n      res && setShowCaptchaPanel(true);\n    });\n  }\n\n  function handleTelChange(_ref) {\n    var value = _ref.target.value;\n    setTel(value);\n  }\n\n  function handleCaptchaCodeChange(_ref2) {\n    var value = _ref2.target.value;\n    setCaptchaCode(value);\n  }\n\n  function sendCaptchaCode() {\n    // {tel, cid, key, challenge, validate, seccode}\n    if (ipcRenderer) {\n      ipcRenderer.invoke(\"send_captcha_code\", {\n        \"tel\": tel,\n        \"cid\": country.id,\n        \"key\": captchaToken.key,\n        \"challenge\": captchaToken.challenge,\n        \"validate\": captchaToken.validate,\n        \"seccode\": captchaToken.seccode\n      }).then(function (res) {\n        console.log(res);\n      });\n    }\n  }\n\n  function userLogin() {\n    if (captchaCode.length !== 6) return;\n    ipcRenderer.invoke(\"request_user_login\", {\n      cid: country.id,\n      tel: tel,\n      smsCode: captchaCode\n    }).then(function (res) {\n      console.log(res);\n    });\n  }\n\n  return /*#__PURE__*/_jsx(\"section\", {\n    id: \"login-panel-container\",\n    onClick: function onClick(e) {\n      e.preventDefault();\n\n      if (e.target.id === 'login-panel-container') {\n        closePenal();\n      }\n    },\n    children: /*#__PURE__*/_jsxs(\"section\", {\n      id: \"login-panel-container-wrapper\",\n      className: \"login-panel-\".concat(show ? 'show' : 'hide'),\n      children: [/*#__PURE__*/_jsxs(\"section\", {\n        className: \"login-panel-wrapper\",\n        children: [/*#__PURE__*/_jsx(Header, {\n          left: /*#__PURE__*/_jsx(\"span\", {\n            className: \"iconfont icon-close login-close-btn\",\n            onClick: function onClick() {\n              return closePenal();\n            }\n          }),\n          center: /*#__PURE__*/_jsx(\"span\", {\n            children: title\n          }),\n          right: /*#__PURE__*/_jsx(\"a\", {\n            href: \"#\",\n            onClick: function onClick() {\n              return changeLoginMethod();\n            },\n            children: loginMethod === 'smscode' ? data.title.password : data.title.smscode\n          })\n        }), /*#__PURE__*/_jsxs(\"section\", {\n          className: \"login-panel-content\",\n          children: [loginMethod === 'smscode' && /*#__PURE__*/_jsxs(\"div\", {\n            className: \"login-panel-content-wrapper\",\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \"login-panel-input-filed\",\n              children: [/*#__PURE__*/_jsxs(\"div\", {\n                className: \"login-panel-input-item country-selector\",\n                onClick: function onClick() {\n                  return handleShowCountryList();\n                },\n                children: [/*#__PURE__*/_jsx(\"span\", {\n                  children: country.cname\n                }), /*#__PURE__*/_jsx(\"i\", {\n                  className: \"iconfont icon-next\"\n                })]\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \"login-panel-input-item phone-number\",\n                children: [/*#__PURE__*/_jsxs(\"span\", {\n                  className: \"input-item-title\",\n                  children: [\"+\", country.country_id]\n                }), /*#__PURE__*/_jsx(_Input, {\n                  onChange: function onChange(e) {\n                    return handleTelChange(e);\n                  },\n                  placeholder: \"\\u8BF7\\u8F93\\u5165\\u624B\\u673A\\u53F7\\u7801\",\n                  maxLength: 16,\n                  allowClear: true,\n                  className: \"phone-number-input\"\n                }), /*#__PURE__*/_jsx(\"span\", {\n                  className: \"getCaptcha\",\n                  onClick: function onClick() {\n                    return displayCaptchaPanel();\n                  },\n                  children: \"\\u83B7\\u53D6\\u9A8C\\u8BC1\\u7801\"\n                })]\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \"login-panel-input-item\",\n                children: [/*#__PURE__*/_jsx(\"span\", {\n                  className: \"input-item-title\",\n                  children: \"\\u9A8C\\u8BC1\\u7801\"\n                }), /*#__PURE__*/_jsx(_Input, {\n                  onChange: function onChange(e) {\n                    return handleCaptchaCodeChange(e);\n                  },\n                  placeholder: \"\\u8BF7\\u8F93\\u5165\\u9A8C\\u8BC1\\u7801\",\n                  maxLength: 8,\n                  allowClear: true,\n                  className: \"captcha-input\"\n                })]\n              }), showCaptchaPanel && /*#__PURE__*/_jsx(\"div\", {\n                className: \"login-panel-input-item captcha-item\",\n                children: showCaptchaPanel && /*#__PURE__*/_jsx(CaptchaPanel, {\n                  setShowCaptchaPanel: setShowCaptchaPanel,\n                  sendCaptchaCode: sendCaptchaCode\n                })\n              })]\n            }), /*#__PURE__*/_jsx(\"a\", {\n              href: \"#\",\n              className: \"smscode-validate-login-btn\",\n              onClick: function onClick() {\n                return userLogin();\n              },\n              children: \"\\u9A8C\\u8BC1\\u767B\\u5F55\"\n            })]\n          }), loginMethod === 'password' && /*#__PURE__*/_jsx(\"section\", {\n            id: \"login-panel-content-wrapper\"\n          })]\n        })]\n      }), /*#__PURE__*/_jsx(CountryListSelect, {\n        show: showCountryList,\n        handleShowCountryList: handleShowCountryList,\n        changeCountry: changeCountry\n      })]\n    })\n  });\n}","map":null,"metadata":{},"sourceType":"module"}